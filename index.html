<script>
  const cart = [];

  function addToCart(productName, price) {
    const existing = cart.find(item => item.name === productName);
    if (existing) {
      existing.quantity++;
      existing.totalPrice = existing.quantity * existing.price;
    } else {
      cart.push({ name: productName, price: price, quantity: 1, totalPrice: price });
    }
    updateCartDisplay();
  }

  function updateCartDisplay() {
    const cartItemsContainer = document.getElementById("cartItems");
    const totalContainer = document.getElementById("totalPrice");

    if (cart.length === 0) {
      cartItemsContainer.innerHTML = "Keranjang kosong";
      totalContainer.innerHTML = "";
      return;
    }

    let html = "<ul>";
    let total = 0;
    cart.forEach(item => {
      html += `<li>${item.name} x ${item.quantity} = Rp${item.totalPrice}</li>`;
      total += item.totalPrice;
    });
    html += "</ul>";
    cartItemsContainer.innerHTML = html;
    totalContainer.innerHTML = `<strong>Total: Rp${total}</strong>`;
  }

  function sendOrderToWhatsApp() {
    const buyerName = document.getElementById("buyerName").value.trim();
    const pickupMethod = document.querySelector('input[name="pickupMethod"]:checked')?.value;
    const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked')?.value;

    if (!buyerName || !pickupMethod || !paymentMethod) {
      alert("Harap lengkapi semua data pemesanan.");
      return;
    }

    if (cart.length === 0) {
      alert("Keranjang masih kosong.");
      return;
    }

    let orderText = `Nama: ${buyerName}\nMetode Pengambilan: ${pickupMethod}\nMetode Pembayaran: ${paymentMethod}\n\nDaftar Pesanan:\n`;
    let total = 0;
    cart.forEach(item => {
      orderText += `${item.name} x ${item.quantity} = Rp${item.totalPrice}\n`;
      total += item.totalPrice;
    });

    if (pickupMethod === "Diantar") {
      const ongkir = cart.reduce((sum, item) => sum + item.quantity * 1000, 0);
      orderText += `\nBiaya Antar: Rp${ongkir}`;
      total += ongkir;
    }

    orderText += `\n\nTotal Bayar: Rp${total}`;

    const whatsappNumber = "089664363463";
    const waUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(orderText)}`;
    window.open(waUrl, "_blank");
  }

  // Splash screen fade
  window.addEventListener("load", function () {
    setTimeout(function () {
      const splash = document.getElementById("splashScreen");
      if (splash) {
        splash.classList.add("fade-out");
        setTimeout(() => splash.style.display = "none", 1000);
      }
    }, 3000);
  });

  // Contoh produk untuk demo (hapus ini kalau sudah pakai loader produk dinamis)
  document.addEventListener("DOMContentLoaded", function () {
    const demoProductList = document.getElementById("productList");
    const sampleProducts = [
      { name: "Donat Cokelat", price: 5000 },
      { name: "Kopi Susu", price: 8000 },
      { name: "Keripik Pedas", price: 7000 }
    ];
    sampleProducts.forEach(prod => {
      const div = document.createElement("div");
      div.innerHTML = `
        <strong>${prod.name}</strong><br/>
        Harga: Rp${prod.price}<br/>
        <button onclick="addToCart('${prod.name}', ${prod.price})">Tambah ke Keranjang</button>
        <hr/>
      `;
      demoProductList.appendChild(div);
    });
  });
</script>
